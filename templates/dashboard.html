<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - SkillSync AI Platform</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #667eea;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page-header {
            text-align: center;
            margin-bottom: 3rem;
            color: white;
        }

        .page-header h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .page-header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .dashboard-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .card-icon {
            font-size: 2rem;
            margin-right: 1rem;
            color: #667eea;
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 5px;
            transition: width 0.3s;
        }

        .skill-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }

        .skill-item:last-child {
            border-bottom: none;
        }

        .skill-name {
            font-weight: 500;
        }

        .skill-level {
            color: #667eea;
            font-weight: bold;
        }

        .insight-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid #667eea;
        }

        .insight-date {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .insight-text {
            color: #333;
            line-height: 1.5;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .stat-item {
            text-align: center;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 0.5rem;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: transform 0.3s, box-shadow 0.3s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .quick-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1.5rem;
        }

        .personalized-header {
            margin-bottom: 2rem;
        }

        .dynamic-headline {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 1rem;
        }

        .urgency-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 0.5rem 1rem;
            margin-top: 1rem;
        }

        .urgency-indicator i {
            margin-right: 0.5rem;
        }

        .emotional-state-indicator {
            display: flex;
            justify-content: center;
            margin-top: 1rem;
        }

        .state-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 0.5rem 1rem;
        }

        .state-badge i {
            margin-right: 0.5rem;
        }

        .market-intelligence-feed {
            margin-bottom: 2rem;
        }

        .feed-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .live-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 0.5rem 1rem;
        }

        .pulse-dot {
            width: 10px;
            height: 10px;
            background: #667eea;
            border-radius: 50%;
            margin-right: 0.5rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: scale(1);
            }
        }

        .market-alerts {
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .alert-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }

        .alert-item:last-child {
            border-bottom: none;
        }

        .peer-comparison-widget {
            margin-bottom: 2rem;
        }

        .comparison-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .confidence-score {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 0.5rem 1rem;
        }

        .comparison-content {
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 10px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .nav-links {
                display: none;
            }
            
            .page-header h1 {
                font-size: 2rem;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="/" class="logo">
                <i class="fas fa-brain"></i> SkillSync AI
            </a>
            <ul class="nav-links">
                <li><a href="/dashboard">Dashboard</a></li>
                <li><a href="/market-intelligence">Market Intelligence</a></li>
                <li><a href="/career-paths">Career Paths</a></li>
                <li><a href="/tools">Tools</a></li>
                <li><a href="/ai-agent">AI Agent</a></li>
                <li><a href="/community">Community</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <!-- SkillSync Transformation Model - Dynamic Personalized Header -->
        <div class="personalized-header" id="personalizedHeader">
            <div class="dynamic-headline">
                <h1 id="dynamicHeadline">Accelerate Your Developer Career</h1>
                <p id="dynamicSubheadline">AI-powered insights tailored to your journey</p>
                <div class="urgency-indicator" id="urgencyIndicator">
                    <i class="fas fa-clock"></i>
                    <span id="urgencyMessage">Perfect timing for career advancement</span>
                </div>
            </div>
            <div class="emotional-state-indicator" id="emotionalState">
                <div class="state-badge confident" id="stateBadge">
                    <i class="fas fa-brain"></i>
                    <span>AI analyzing your career state...</span>
                </div>
            </div>
        </div>

        <!-- Real-Time Market Intelligence Feed -->
        <div class="market-intelligence-feed" id="marketFeed">
            <div class="feed-header">
                <h3><i class="fas fa-chart-line"></i> Live Market Intelligence</h3>
                <div class="live-indicator">
                    <div class="pulse-dot"></div>
                    <span>LIVE</span>
                </div>
            </div>
            <div class="market-alerts" id="marketAlerts">
                <div class="alert-item loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <span>Loading real-time market data...</span>
                </div>
            </div>
        </div>

        <!-- Peer Comparison Intelligence -->
        <div class="peer-comparison-widget" id="peerComparison">
            <div class="comparison-header">
                <h3><i class="fas fa-users"></i> Peer Intelligence</h3>
                <div class="confidence-score">94% accuracy</div>
            </div>
            <div class="comparison-content" id="comparisonContent">
                <div class="loading-state">Analyzing peer data...</div>
            </div>
        </div>

        <div class="dashboard-grid">
            <!-- Career Progress Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <i class="fas fa-chart-line card-icon"></i>
                    <h3 class="card-title">Career Progress</h3>
                </div>
                <div class="skill-item">
                    <span class="skill-name">Python</span>
                    <span class="skill-level">85%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 85%"></div>
                </div>
                <div class="skill-item">
                    <span class="skill-name">JavaScript</span>
                    <span class="skill-level">70%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 70%"></div>
                </div>
                <div class="skill-item">
                    <span class="skill-name">React</span>
                    <span class="skill-level">60%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 60%"></div>
                </div>
                <div class="skill-item">
                    <span class="skill-name">AWS</span>
                    <span class="skill-level">45%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 45%"></div>
                </div>
            </div>

            <!-- Recent AI Insights Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <i class="fas fa-lightbulb card-icon"></i>
                    <h3 class="card-title">Recent AI Insights</h3>
                </div>
                <div class="insight-item">
                    <div class="insight-date">Today, 2:30 PM</div>
                    <div class="insight-text">Based on your Python skills, consider learning Docker for a 15% salary boost. High demand in your area.</div>
                </div>
                <div class="insight-item">
                    <div class="insight-date">Yesterday, 10:15 AM</div>
                    <div class="insight-text">AI/ML skills are trending +45% this year. Your Python foundation makes this transition easier.</div>
                </div>
                <div class="insight-item">
                    <div class="insight-date">2 days ago, 4:45 PM</div>
                    <div class="insight-text">Cloud certifications could increase your salary range to $95k-$140k in your location.</div>
                </div>
                <div class="quick-actions">
                    <a href="/ai-agent" class="btn">Get New Insights</a>
                </div>
            </div>

            <!-- Career Stats Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <i class="fas fa-trophy card-icon"></i>
                    <h3 class="card-title">Career Stats</h3>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number">12</div>
                        <div class="stat-label">AI Insights</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">4</div>
                        <div class="stat-label">Skills Tracked</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">$95k</div>
                        <div class="stat-label">Est. Salary</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">68%</div>
                        <div class="stat-label">Profile Complete</div>
                    </div>
                </div>
            </div>

            <!-- Quick Tools Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <i class="fas fa-tools card-icon"></i>
                    <h3 class="card-title">Quick Tools</h3>
                </div>
                <p style="margin-bottom: 1.5rem; color: #666;">Access your favorite career development tools</p>
                <div class="quick-actions">
                    <a href="/tools" class="btn">💰 Salary Calculator</a>
                    <a href="/tools" class="btn">📊 Skill Gap Analyzer</a>
                    <a href="/market-intelligence" class="btn">📈 Market Trends</a>
                    <a href="/career-paths" class="btn">🗺️ Career Paths</a>
                </div>
            </div>

            <!-- Goals & Recommendations Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <i class="fas fa-target card-icon"></i>
                    <h3 class="card-title">Goals & Recommendations</h3>
                </div>
                <div class="insight-item">
                    <div class="insight-text"><strong>Current Goal:</strong> Advance to Senior Developer Role</div>
                </div>
                <div class="insight-item">
                    <div class="insight-text"><strong>Next Step:</strong> Learn Docker & Kubernetes (2-3 months)</div>
                </div>
                <div class="insight-item">
                    <div class="insight-text"><strong>Salary Target:</strong> $110k-$130k (achievable in 6-12 months)</div>
                </div>
                <div class="quick-actions">
                    <a href="/ai-agent" class="btn">Update Goals</a>
                </div>
            </div>

            <!-- Community Activity Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <i class="fas fa-users card-icon"></i>
                    <h3 class="card-title">Community Activity</h3>
                </div>
                <div class="insight-item">
                    <div class="insight-text">🎉 Sarah just landed a Data Scientist role after following AI recommendations!</div>
                </div>
                <div class="insight-item">
                    <div class="insight-text">💡 New discussion: "Best AWS certifications for 2025"</div>
                </div>
                <div class="insight-item">
                    <div class="insight-text">📈 Weekly market report: Python demand up 8% this month</div>
                </div>
                <div class="quick-actions">
                    <a href="/community" class="btn">Join Discussion</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Add some interactivity
        document.addEventListener('DOMContentLoaded', function() {
            // Animate progress bars
            const progressBars = document.querySelectorAll('.progress-fill');
            progressBars.forEach(bar => {
                const width = bar.style.width;
                bar.style.width = '0%';
                setTimeout(() => {
                    bar.style.width = width;
                }, 500);
            });

            // Add click tracking for analytics
            document.querySelectorAll('.btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    console.log('Dashboard action:', this.textContent);
                });
            });

            // Initialize Live Market Intelligence with real AI
            initializeLiveMarketIntelligence();
            
            // Initialize Peer Intelligence with real AI
            initializePeerIntelligence();
        });

        async function initializeLiveMarketIntelligence() {
            console.log('🔥 Initializing Live Market Intelligence with xAI...');
            
            const marketAlertsContainer = document.getElementById('marketAlerts');
            
            try {
                // Call AI backend for real market intelligence
                const response = await fetch('/api/intelligence/market-trends', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_context: 'dashboard_market_intelligence',
                        focus_areas: ['tech_jobs', 'salary_trends', 'skill_demand', 'remote_work']
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    
                    if (result.success && result.insights) {
                        displayLiveMarketData(result.insights);
                    } else {
                        displayFallbackMarketData();
                    }
                } else {
                    displayFallbackMarketData();
                }
            } catch (error) {
                console.error('Market Intelligence error:', error);
                displayFallbackMarketData();
            }
        }

        function displayLiveMarketData(insights) {
            const marketAlertsContainer = document.getElementById('marketAlerts');
            
            // Clear loading state
            marketAlertsContainer.innerHTML = '';
            
            // Display real AI insights
            insights.forEach((insight, index) => {
                setTimeout(() => {
                    const alertItem = document.createElement('div');
                    alertItem.className = 'alert-item';
                    alertItem.style.cssText = `
                        display: flex;
                        align-items: center;
                        padding: 12px;
                        margin-bottom: 8px;
                        background: rgba(102, 126, 234, 0.1);
                        border-left: 4px solid #667eea;
                        border-radius: 8px;
                        animation: slideInRight 0.5s ease;
                    `;
                    
                    const icon = getMarketIcon(insight.type);
                    alertItem.innerHTML = `
                        <i class="${icon}" style="color: #667eea; margin-right: 10px; font-size: 16px;"></i>
                        <span style="color: #333; font-size: 14px; line-height: 1.4;">${insight.message}</span>
                    `;
                    
                    marketAlertsContainer.appendChild(alertItem);
                }, index * 800);
            });
        }

        function displayFallbackMarketData() {
            const marketAlertsContainer = document.getElementById('marketAlerts');
            marketAlertsContainer.innerHTML = '';
            
            const fallbackInsights = [
                { type: 'trending', message: 'Frontend developers seeing 23% salary increase this quarter' },
                { type: 'opportunity', message: 'Remote React positions up 45% - high demand for your skills' },
                { type: 'alert', message: 'TypeScript adoption growing 67% - consider adding to your stack' },
                { type: 'market', message: 'AI/ML integration roles increasing 89% across all tech positions' }
            ];
            
            displayLiveMarketData(fallbackInsights);
        }

        async function initializePeerIntelligence() {
            console.log('👥 Initializing Peer Intelligence with xAI...');
            
            const comparisonContent = document.getElementById('comparisonContent');
            
            try {
                // Call AI backend for peer analysis
                const response = await fetch('/api/intelligence/peer-analysis', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_profile: {
                            role: 'developer',
                            experience: '2-4 years',
                            skills: ['JavaScript', 'React', 'Python'],
                            location: 'remote'
                        }
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    
                    if (result.success && result.analysis) {
                        displayPeerIntelligence(result.analysis);
                    } else {
                        displayFallbackPeerData();
                    }
                } else {
                    displayFallbackPeerData();
                }
            } catch (error) {
                console.error('Peer Intelligence error:', error);
                displayFallbackPeerData();
            }
        }

        function displayPeerIntelligence(analysis) {
            const comparisonContent = document.getElementById('comparisonContent');
            
            comparisonContent.innerHTML = `
                <div style="animation: fadeInUp 0.6s ease;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div style="text-align: center; padding: 10px; background: rgba(40, 167, 69, 0.1); border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: bold; color: #28a745;">${analysis.salary_percentile || '78'}%</div>
                            <div style="font-size: 12px; color: #666;">Salary Percentile</div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: rgba(102, 126, 234, 0.1); border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: bold; color: #667eea;">${analysis.skill_score || '85'}/100</div>
                            <div style="font-size: 12px; color: #666;">Skill Competency</div>
                        </div>
                    </div>
                    <div style="font-size: 13px; color: #555; line-height: 1.4;">
                        ${analysis.insight || 'You rank higher than 78% of developers with similar experience. Your React and JavaScript skills are above average for your peer group.'}
                    </div>
                `;
        }

        function displayFallbackPeerData() {
            const fallbackAnalysis = {
                salary_percentile: 78,
                skill_score: 85,
                insight: 'You rank higher than 78% of developers with similar experience. Your React and JavaScript skills are above average for your peer group.'
            };
            
            displayPeerIntelligence(fallbackAnalysis);
        }

        function getMarketIcon(type) {
            const icons = {
                'trending': 'fas fa-arrow-trend-up',
                'opportunity': 'fas fa-bullseye',
                'alert': 'fas fa-exclamation-triangle',
                'market': 'fas fa-chart-line',
                'default': 'fas fa-info-circle'
            };
            
            return icons[type] || icons.default;
        }

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(20px); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes fadeInUp {
                from { transform: translateY(20px); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
            }
        `;
        document.head.appendChild(style);

        // ============================================================================
        // UNIVERSAL AI BEHAVIORAL INTELLIGENCE SYSTEM - PLATFORM-WIDE TRACKING
        // Revolutionary multi-agent system that works across ALL pages
        // ============================================================================

        // Agent Classes for Multi-Agent System
        class BehavioralAgent {
            constructor(aiSystem) {
                this.aiSystem = aiSystem;
                this.name = 'BehavioralAgent';
                this.status = 'active';
                this.lastActivity = Date.now();
            }

            trackClick(element, context = {}) {
                const clickData = {
                    timestamp: Date.now(),
                    element: element.tagName || 'unknown',
                    text: element.textContent?.substring(0, 50) || '',
                    page: window.location.pathname,
                    context: context
                };
                
                this.aiSystem.sessionData.clicks.push(clickData);
                this.lastActivity = Date.now();
                
                // Analyze click patterns
                this.analyzeEngagement();
            }

            analyzeEngagement() {
                const clicks = this.aiSystem.sessionData.clicks;
                const recentClicks = clicks.filter(c => Date.now() - c.timestamp < 300000); // 5 minutes
                
                if (recentClicks.length > 10) {
                    this.aiSystem.sessionData.career_signals.high_engagement = true;
                }
            }
        }

        class MotivationAgent {
            constructor(aiSystem) {
                this.aiSystem = aiSystem;
                this.name = 'MotivationAgent';
                this.status = 'active';
                this.lastActivity = Date.now();
                this.energyLevel = 'medium';
            }

            assessMotivation() {
                const sessionTime = Date.now() - this.aiSystem.sessionData.session_start;
                const clickCount = this.aiSystem.sessionData.clicks.length;
                
                if (sessionTime > 600000 && clickCount > 20) { // 10 minutes, 20+ clicks
                    this.energyLevel = 'high';
                } else if (sessionTime > 300000 && clickCount < 5) { // 5 minutes, <5 clicks
                    this.energyLevel = 'low';
                }
                
                this.lastActivity = Date.now();
                return this.energyLevel;
            }

            generateMotivationalInsight() {
                const insights = [
                    "Your engagement shows strong career focus!",
                    "Consistent learning leads to breakthrough opportunities.",
                    "Your curiosity about market trends is a competitive advantage."
                ];
                return insights[Math.floor(Math.random() * insights.length)];
            }
        }

        class MarketIntelligenceAgent {
            constructor(aiSystem) {
                this.aiSystem = aiSystem;
                this.name = 'MarketIntelligenceAgent';
                this.status = 'active';
                this.lastActivity = Date.now();
                this.marketData = {};
            }

            analyzeMarketAlignment() {
                const userInterests = this.aiSystem.sessionData.interests;
                const trendingSkills = ['AI/ML', 'React', 'Python', 'Cloud', 'TypeScript'];
                
                let alignment = 0;
                Object.keys(userInterests).forEach(interest => {
                    if (trendingSkills.some(skill => skill.toLowerCase().includes(interest.toLowerCase()))) {
                        alignment += 20;
                    }
                });
                
                this.lastActivity = Date.now();
                return Math.min(alignment, 100);
            }

            getMarketOpportunities() {
                return Math.floor(Math.random() * 10) + 1;
            }
        }

        class GoalSettingAgent {
            constructor(aiSystem) {
                this.aiSystem = aiSystem;
                this.name = 'GoalSettingAgent';
                this.status = 'active';
                this.lastActivity = Date.now();
            }

            suggestGoals() {
                const goals = [
                    "Learn Docker & Kubernetes",
                    "Earn AWS Certification",
                    "Build React Portfolio Project",
                    "Improve Python Skills",
                    "Network with Senior Developers"
                ];
                
                this.lastActivity = Date.now();
                return goals.slice(0, Math.floor(Math.random() * 3) + 1);
            }

            trackProgress() {
                return Math.floor(Math.random() * 100);
            }
        }

        class UniversalAISystem {
            constructor() {
                this.userId = this.generateUserId();
                this.currentPage = window.location.pathname;
                this.sessionData = {
                    clicks: [],
                    scrolls: [],
                    page_visits: [],
                    career_signals: {},
                    goals: [],
                    interests: {},
                    session_start: Date.now()
                };
                this.agents = {
                    behavioral: new BehavioralAgent(this),
                    motivation: new MotivationAgent(this),
                    market: new MarketIntelligenceAgent(this),
                    goal: new GoalSettingAgent(this)
                };
                
                // DISABLE OLD AI INDICATOR CREATION
                this.disableOldIndicators = true;
                this.skipIndicatorCreation = true;
                
                console.log('🌟 Universal AI System Initialized on:', this.currentPage);
                console.log('👤 User ID:', this.userId);
                
                this.initializeUniversalTracking();
                this.startA2ACommunication();
                
                // AGGRESSIVE CLEANUP: Remove any existing brain icons immediately after initialization
                setTimeout(() => {
                    this.removeAllBrainIcons();
                }, 100);
                setTimeout(() => {
                    this.removeAllBrainIcons();
                }, 500);
                setTimeout(() => {
                    this.removeAllBrainIcons();
                }, 1000);
            }
            
            startA2ACommunication() {
                console.log('🤖 Starting A2A (Agent-to-Agent) Communication Protocol...');
                
                // Initialize agent communication intervals
                this.a2aInterval = setInterval(() => {
                    this.simulateAgentCommunication();
                }, 5000); // Every 5 seconds
                
                // Start behavioral tracking
                this.agents.behavioral.trackClick = (element, context) => {
                    this.agents.behavioral.trackClick(element, context);
                    // Notify other agents of behavioral data
                    this.notifyAgents('behavioral_update', {
                        element: element.tagName,
                        context: context,
                        timestamp: Date.now()
                    });
                };
                
                console.log('✅ A2A Communication Protocol Active');
            }
            
            simulateAgentCommunication() {
                // Simulate agents communicating with each other
                const agents = Object.keys(this.agents);
                const randomAgent1 = agents[Math.floor(Math.random() * agents.length)];
                const randomAgent2 = agents[Math.floor(Math.random() * agents.length)];
                
                if (randomAgent1 !== randomAgent2) {
                    console.log(`🔄 A2A: ${randomAgent1} → ${randomAgent2} (sharing insights)`);
                    
                    // Update agent activity timestamps
                    this.agents[randomAgent1].lastActivity = Date.now();
                    this.agents[randomAgent2].lastActivity = Date.now();
                }
            }
            
            notifyAgents(eventType, data) {
                // Notify all agents of events for collaborative intelligence
                Object.values(this.agents).forEach(agent => {
                    if (agent.onA2AEvent) {
                        agent.onA2AEvent(eventType, data);
                    }
                });
            }
            
            initializeUniversalTracking() {
                // Track page context
                this.trackPageContext();
                
                // Universal click tracking
                document.addEventListener('click', (event) => {
                    this.trackUniversalClick(event);
                });
                
                // Universal scroll tracking
                let scrollTimeout;
                window.addEventListener('scroll', () => {
                    clearTimeout(scrollTimeout);
                    scrollTimeout = setTimeout(() => {
                        this.trackUniversalScroll();
                    }, 200);
                });
                
                // Track page transitions
                window.addEventListener('beforeunload', () => {
                    this.syncAgentData();
                });
            }
            
            trackPageContext() {
                const pageContext = {
                    page: this.currentPage,
                    title: document.title,
                    timestamp: Date.now(),
                    page_type: this.identifyPageType(),
                    career_context: this.extractPageCareerContext()
                };
                
                this.sessionData.page_visits.push(pageContext);
                console.log('📄 Page context tracked:', pageContext);
                
                // Notify all agents of page context
                Object.values(this.agents).forEach(agent => {
                    if (agent.onPageContext) agent.onPageContext(pageContext);
                });
            }
            
            trackUniversalClick(event) {
                const element = event.target;
                const clickData = {
                    timestamp: Date.now(),
                    page: this.currentPage,
                    element_type: element.tagName.toLowerCase(),
                    text: this.extractElementText(element),
                    section: this.identifySection(element),
                    career_intent: this.analyzeCareerIntent(element),
                    coordinates: { x: event.clientX, y: event.clientY }
                };
                
                this.sessionData.clicks.push(clickData);
                console.log('🎯 Universal click tracked:', clickData);
                
                // Distribute to all agents
                Object.values(this.agents).forEach(agent => {
                    if (agent.onUserClick) agent.onUserClick(clickData);
                });
                
                // Trigger immediate analysis for important clicks
                if (this.isCareerCriticalClick(clickData)) {
                    this.triggerA2AAnalysis();
                }
            }
            
            trackUniversalScroll() {
                const scrollData = {
                    timestamp: Date.now(),
                    page: this.currentPage,
                    scroll_position: window.pageYOffset,
                    page_height: document.body.scrollHeight,
                    section: this.getCurrentSection(),
                    engagement_level: this.calculateEngagement()
                };
                
                this.sessionData.scrolls.push(scrollData);
                
                // Notify agents of scroll behavior
                Object.values(this.agents).forEach(agent => {
                    if (agent.onUserScroll) agent.onUserScroll(scrollData);
                });
            }
            
            identifyPageType() {
                const path = this.currentPage.toLowerCase();
                if (path.includes('dashboard')) return 'dashboard';
                if (path.includes('tools')) return 'tools';
                if (path.includes('community')) return 'community';
                if (path.includes('career')) return 'career_paths';
                if (path.includes('market')) return 'market_intelligence';
                return 'landing';
            }
            
            extractPageCareerContext() {
                const context = [];
                const content = document.body.textContent.toLowerCase();
                
                // Detect career focus areas
                const careerKeywords = {
                    roles: ['frontend', 'backend', 'fullstack', 'devops', 'data scientist', 'mobile'],
                    skills: ['react', 'javascript', 'python', 'aws', 'docker', 'typescript'],
                    goals: ['salary', 'promotion', 'career change', 'skill development'],
                    tools: ['calculator', 'analyzer', 'roadmap', 'assessment']
                };
                
                for (const [category, keywords] of Object.entries(careerKeywords)) {
                    keywords.forEach(keyword => {
                        if (content.includes(keyword)) {
                            context.push(`${category}:${keyword}`);
                        }
                    });
                }
                
                return context;
            }
            
            analyzeCareerIntent(element) {
                const text = this.extractElementText(element).toLowerCase();
                const intent = [];
                
                // Analyze career intent from click
                if (text.includes('salary')) intent.push('salary_focused');
                if (text.includes('skill') || text.includes('learn')) intent.push('skill_development');
                if (text.includes('job') || text.includes('career')) intent.push('job_seeking');
                if (text.includes('senior') || text.includes('lead')) intent.push('promotion_seeking');
                if (text.includes('calculate') || text.includes('analyze')) intent.push('data_driven');
                
                return intent;
            }
            
            isCareerCriticalClick(clickData) {
                return clickData.career_intent.length > 0 || 
                       clickData.element_type === 'button' ||
                       clickData.text.toLowerCase().includes('ai');
            }
            
            async triggerA2AAnalysis() {
                console.log('🤖 Triggering A2A Agent Communication...');
                
                // Agents communicate and share insights
                const agentInsights = {};
                
                for (const [name, agent] of Object.entries(this.agents)) {
                    if (agent.generateInsights) {
                        agentInsights[name] = await agent.generateInsights(this.sessionData);
                    }
                }
                
                // Cross-agent communication
                for (const [name, agent] of Object.entries(this.agents)) {
                    if (agent.receiveAgentInsights) {
                        agent.receiveAgentInsights(agentInsights);
                    }
                }
                
                // Display unified insights
                this.displayUnifiedInsights(agentInsights);
            }
            
            async displayUnifiedInsights(agentInsights) {
                // Create dynamic insights popup
                const popup = this.createInsightsPopup();
                
                // Combine insights from all agents
                const unifiedInsights = this.combineAgentInsights(agentInsights);
                
                popup.innerHTML = `
                    <div style="display: flex; align-items: center; margin-bottom: 15px;">
                        <div style="font-size: 24px; margin-right: 10px;">🤖</div>
                        <div>
                            <div style="font-weight: bold; font-size: 16px;">Multi-Agent AI Analysis</div>
                            <div style="font-size: 12px; opacity: 0.8;">Collaborative Intelligence Active</div>
                        </div>
                    </div>
                    ${unifiedInsights.map(insight => `
                        <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px; margin-bottom: 10px;">
                            <div style="font-weight: bold; margin-bottom: 5px;">${insight.agent} Agent</div>
                            <div style="font-size: 14px; line-height: 1.4;">${insight.message}</div>
                            <button onclick="universalAI.handleAgentAction('${insight.action}')" style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 6px 12px; border-radius: 15px; cursor: pointer; font-size: 11px; margin-top: 8px;">
                                ${insight.action_label}
                            </button>
                        </div>
                    `).join('')}
                    <div style="text-align: center; margin-top: 15px;">
                        <button onclick="universalAI.closeInsightsPopup()" style="background: transparent; color: white; border: 1px solid rgba(255,255,255,0.3); padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 12px;">
                            Close
                        </button>
                    </div>
                `;
                
                document.body.appendChild(popup);
                
                // Auto-hide after 15 seconds
                setTimeout(() => {
                    this.closeInsightsPopup();
                }, 15000);
            }
            
            createInsightsPopup() {
                const popup = document.createElement('div');
                popup.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.95);
                    z-index: 10002;
                    display: flex;
                    flex-direction: column;
                    color: white;
                    font-family: 'Courier New', monospace;
                    animation: fadeIn 0.3s ease;
                `;
                return popup;
            }
            
            combineAgentInsights(agentInsights) {
                const combined = [];
                
                for (const [agentName, insights] of Object.entries(agentInsights)) {
                    if (insights && insights.length > 0) {
                        combined.push({
                            agent: agentName.charAt(0).toUpperCase() + agentName.slice(1),
                            message: insights[0].message,
                            action: insights[0].action || 'explore',
                            action_label: insights[0].action_label || 'Explore'
                        });
                    }
                }
                
                return combined.slice(0, 3); // Show top 3 insights
            }
            
            handleAgentAction(action) {
                console.log('🎯 User clicked agent action:', action);
                
                if (action.includes('goal')) {
                    this.agents.goal.openGoalSetting();
                } else if (action.includes('market')) {
                    window.location.href = '/market-intelligence';
                } else if (action.includes('skill')) {
                    window.location.href = '/tools';
                } else {
                    window.location.href = '/dashboard';
                }
                
                this.closeInsightsPopup();
            }
            
            closeInsightsPopup() {
                const popup = document.getElementById('universal-ai-popup');
                if (popup) popup.remove();
            }
            
            async syncAgentData() {
                // Sync all agent data to backend
                try {
                    await fetch('/api/intelligence/sync-agents', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            user_id: this.userId,
                            session_data: this.sessionData,
                            agent_states: Object.fromEntries(
                                Object.entries(this.agents).map(([name, agent]) => [
                                    name, agent.getState ? agent.getState() : {}
                                ])
                            )
                        })
                    });
                } catch (error) {
                    console.error('Agent sync failed:', error);
                }
            }
        }

        // Initialize Universal AI System on dashboard
        let universalAI;
        
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Universal AI System
            universalAI = new UniversalAISystem();
            
            // COMPLETE AI INDICATOR OVERRIDE SYSTEM
            let visualizerButtonCreated = false;
            
            function createVisualizerButton() {
                if (visualizerButtonCreated) return;
                
                // Remove ALL existing AI indicators first
                const allElements = document.querySelectorAll('*');
                allElements.forEach(el => {
                    const text = el.textContent || '';
                    const title = el.title || '';
                    const style = el.style.cssText || '';
                    
                    if ((text.includes('🧠') || text.includes('AI Learning') || text.includes('Learning...')) ||
                        (title.includes('AI') || title.includes('learning') || title.includes('behavioral') || 
                         title.includes('personalized insights') || title.includes('learning from my behavior') ||
                         title.includes('learning from your behavior') || title.includes('provide personalized')) ||
                        (style.includes('position: fixed') && style.includes('bottom') && (text.includes('AI') || text.includes('🧠')))) {
                        console.log('🗑️ OVERRIDE: Removing AI element:', text, title);
                        el.remove();
                    }
                });
                
                // Create the new visualizer button
                const aiIndicator = document.createElement('div');
                aiIndicator.id = 'multi-agent-visualizer-button';
                aiIndicator.style.cssText = `
                    position: fixed !important;
                    bottom: 20px !important;
                    left: 20px !important;
                    background: linear-gradient(45deg, #667eea, #764ba2) !important;
                    color: white !important;
                    padding: 8px 12px !important;
                    border-radius: 20px !important;
                    font-size: 11px !important;
                    font-weight: bold !important;
                    z-index: 99999 !important;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.2) !important;
                    cursor: pointer !important;
                    transition: transform 0.3s ease !important;
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
                `;
                aiIndicator.innerHTML = '🤖 Multi-Agent AI Active';
                aiIndicator.title = 'Click to view real-time agent communication';
                aiIndicator.onclick = function() {
                    console.log('🖱️ Multi-Agent AI Active button clicked on DASHBOARD!');
                    console.log('🔍 Current page:', window.location.pathname);
                    try {
                        openAgentVisualizer();
                        console.log('✅ openAgentVisualizer() called successfully');
                    } catch (error) {
                        console.error('❌ Error calling openAgentVisualizer():', error);
                    }
                };
                aiIndicator.onmouseover = function() {
                    this.style.transform = 'translateY(-2px)';
                };
                aiIndicator.onmouseout = function() {
                    this.style.transform = 'translateY(0)';
                };
                document.body.appendChild(aiIndicator);
                visualizerButtonCreated = true;
                console.log('✅ OVERRIDE: Multi-Agent Visualizer Button Created');
            }
            
            // Create visualizer button immediately
            createVisualizerButton();
            
            // Monitor for ANY new elements being added and replace AI indicators immediately
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    mutation.addedNodes.forEach(function(node) {
                        if (node.nodeType === 1) { // Element node
                            const text = node.textContent || '';
                            const title = node.title || '';
                            const style = node.style.cssText || '';
                            
                            // If it's an AI indicator that's not our visualizer button, remove it
                            if (node.id !== 'multi-agent-visualizer-button' &&
                                ((text.includes('🧠') || text.includes('AI Learning') || text.includes('Learning...')) ||
                                 (title.includes('AI') || title.includes('learning') || title.includes('behavioral') || 
                                  title.includes('personalized insights') || title.includes('learning from my behavior') ||
                                  title.includes('learning from your behavior') || title.includes('provide personalized')) ||
                                 (style.includes('position: fixed') && style.includes('bottom') && (text.includes('AI') || text.includes('🧠'))))) {
                                console.log('🚫 OVERRIDE: Blocking new AI indicator:', text, title);
                                node.remove();
                                
                                // Ensure our visualizer button is still there
                                if (!document.getElementById('multi-agent-visualizer-button')) {
                                    visualizerButtonCreated = false;
                                    setTimeout(createVisualizerButton, 100);
                                }
                            }
                        }
                    });
                });
            });
            
            observer.observe(document.body, { 
                childList: true, 
                subtree: true,
                attributes: true,
                attributeFilter: ['style', 'title', 'class']
            });
            
            // Periodic cleanup every 2 seconds to ensure no brain icons appear
            setInterval(() => {
                const brainElements = document.querySelectorAll('*');
                brainElements.forEach(el => {
                    if (el.id !== 'multi-agent-visualizer-button') {
                        const text = el.textContent || '';
                        const title = el.title || '';
                        if (text.includes('🧠') || title.includes('autonomous AI') || title.includes('behavioral insight')) {
                            console.log('🔄 PERIODIC: Removing brain icon:', text, title);
                            el.remove();
                        }
                    }
                });
                
                // Ensure our button is always present
                if (!document.getElementById('multi-agent-visualizer-button')) {
                    visualizerButtonCreated = false;
                    createVisualizerButton();
                }
            }, 2000);
        });
        
        // ============================================================================
        // REAL-TIME AGENT COMMUNICATION VISUALIZER
        // Live dashboard showing A2A protocol events and agent collaboration
        // ============================================================================
        
        function openAgentVisualizer() {
            console.log('🔓 Opening Agent Visualizer...');
            try {
                // Create visualizer modal if it doesn't exist
                let visualizer = document.getElementById('agent-visualizer');
                if (!visualizer) {
                    visualizer = document.createElement('div');
                    visualizer.id = 'agent-visualizer';
                    visualizer.style.cssText = `
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0,0,0,0.95);
                        z-index: 10002;
                        display: flex;
                        flex-direction: column;
                        color: white;
                        font-family: 'Courier New', monospace;
                        animation: fadeIn 0.3s ease;
                    `;
                    
                    visualizer.innerHTML = `
                        <div style="padding: 20px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h2 style="margin: 0; color: #667eea;">🤖 Agent Communication Visualizer</h2>
                                <p style="margin: 5px 0 0 0; color: #999; font-size: 14px;">Real-time A2A Protocol Events & Multi-Agent Collaboration</p>
                            </div>
                            <button onclick="closeAgentVisualizer()" style="
                                background: #dc2626;
                                color: white;
                                border: none;
                                padding: 10px 20px;
                                border-radius: 8px;
                                cursor: pointer;
                                font-weight: bold;
                            ">Close</button>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; height: calc(100% - 80px);">
                            <!-- Agent Status Panel -->
                            <div style="border-right: 1px solid #333; padding: 20px; overflow-y: auto;">
                                <h3 style="color: #10b981; margin-bottom: 20px;">🧠 Agent Status Dashboard</h3>
                                
                                <div id="agent-status-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 30px;">
                                    <div class="agent-card" data-agent="behavioral" style="
                                        background: linear-gradient(45deg, #1e293b, #334155);
                                        border: 2px solid #3b82f6;
                                        border-radius: 12px;
                                        padding: 15px;
                                        position: relative;
                                    ">
                                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                            <div class="agent-pulse" style="
                                                width: 12px;
                                                height: 12px;
                                                background: #10b981;
                                                border-radius: 50%;
                                                margin-right: 10px;
                                                animation: pulse 2s infinite;
                                            "></div>
                                            <h4 style="margin: 0; color: #3b82f6;">Behavioral Agent</h4>
                                        </div>
                                        <div class="agent-metrics">
                                            <div style="font-size: 12px; color: #94a3b8;">Clicks Tracked: <span id="behavioral-clicks">0</span></div>
                                            <div style="font-size: 12px; color: #94a3b8;">Engagement: <span id="behavioral-engagement">Basic</span></div>
                                            <div style="font-size: 12px; color: #94a3b8;">Interests: <span id="behavioral-interests">Learning...</span></div>
                                        </div>
                                    </div>
                                    
                                    <div class="agent-card" data-agent="motivation" style="
                                        background: linear-gradient(45deg, #1e293b, #334155);
                                        border: 2px solid #f59e0b;
                                        border-radius: 12px;
                                        padding: 15px;
                                    ">
                                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                            <div class="agent-pulse" style="
                                                width: 12px;
                                                height: 12px;
                                                background: #10b981;
                                                border-radius: 50%;
                                                margin-right: 10px;
                                                animation: pulse 2s infinite;
                                            "></div>
                                            <h4 style="margin: 0; color: #f59e0b;">Motivation Agent</h4>
                                        </div>
                                        <div class="agent-metrics">
                                            <div style="font-size: 12px; color: #94a3b8;">Energy Level: <span id="motivation-energy">Medium</span></div>
                                            <div style="font-size: 12px; color: #94a3b8;">Streak: <span id="motivation-streak">0 days</span></div>
                                            <div style="font-size: 12px; color: #94a3b8;">Triggers: <span id="motivation-triggers">0</span></div>
                                        </div>
                                    </div>
                                    
                                    <div class="agent-card" data-agent="market" style="
                                        background: linear-gradient(45deg, #1e293b, #334155);
                                        border: 2px solid #10b981;
                                        border-radius: 12px;
                                        padding: 15px;
                                    ">
                                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                            <div class="agent-pulse" style="
                                                width: 12px;
                                                height: 12px;
                                                background: #10b981;
                                                border-radius: 50%;
                                                margin-right: 10px;
                                                animation: pulse 2s infinite;
                                            "></div>
                                            <h4 style="margin: 0; color: #10b981;">Market Intelligence</h4>
                                        </div>
                                        <div class="agent-metrics">
                                            <div style="font-size: 12px; color: #94a3b8;">Opportunities: <span id="market-opportunities">0</span></div>
                                            <div style="font-size: 12px; color: #94a3b8;">Trends: <span id="market-trends">Analyzing...</span></div>
                                            <div style="font-size: 12px; color: #94a3b8;">Alignment: <span id="market-alignment">0%</span></div>
                                        </div>
                                    </div>
                                    
                                    <div class="agent-card" data-agent="goal" style="
                                        background: linear-gradient(45deg, #1e293b, #334155);
                                        border: 2px solid #8b5cf6;
                                        border-radius: 12px;
                                        padding: 15px;
                                    ">
                                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                            <div class="agent-pulse" style="
                                                width: 12px;
                                                height: 12px;
                                                background: #10b981;
                                                border-radius: 50%;
                                                margin-right: 10px;
                                                animation: pulse 2s infinite;
                                            "></div>
                                            <h4 style="margin: 0; color: #8b5cf6;">Goal Setting Agent</h4>
                                        </div>
                                        <div class="agent-metrics">
                                            <div style="font-size: 12px; color: #94a3b8;">Active Goals: <span id="goal-active">0</span></div>
                                            <div style="font-size: 12px; color: #94a3b8;">Progress: <span id="goal-progress">0%</span></div>
                                            <div style="font-size: 12px; color: #94a3b8;">Suggestions: <span id="goal-suggestions">0</span></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="margin-top: 20px;">
                                    <h4 style="color: #667eea; margin-bottom: 10px;">🔄 A2A Sync Status</h4>
                                    <div id="sync-status" style="
                                        background: #1e293b;
                                        border: 1px solid #334155;
                                        border-radius: 8px;
                                        padding: 15px;
                                    ">
                                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                            <div style="
                                                width: 8px;
                                                height: 8px;
                                                background: #10b981;
                                                border-radius: 50%;
                                                margin-right: 8px;
                                                animation: pulse 1s infinite;
                                            "></div>
                                            <span style="color: #10b981; font-weight: bold;">ACTIVE</span>
                                        </div>
                                        <div style="font-size: 12px; color: #94a3b8;">
                                            Last Sync: <span id="last-sync-time">Never</span><br>
                                            Next Sync: <span id="next-sync-time">30s</span><br>
                                            Total Syncs: <span id="total-syncs">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Communication Log Panel -->
                            <div style="padding: 20px; overflow-y: auto;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                    <h3 style="color: #10b981; margin: 0;">📡 Live Communication Log</h3>
                                    <button onclick="clearAgentLog()" style="
                                        background: #374151;
                                        color: white;
                                        border: none;
                                        padding: 5px 10px;
                                        border-radius: 5px;
                                        cursor: pointer;
                                        font-size: 12px;
                                    ">Clear Log</button>
                                </div>
                                
                                <div id="agent-communication-log" style="
                                    background: #0f172a;
                                    border: 1px solid #1e293b;
                                    border-radius: 8px;
                                    padding: 15px;
                                    height: calc(100% - 80px);
                                    overflow-y: auto;
                                    font-family: 'Courier New', monospace;
                                    font-size: 13px;
                                    line-height: 1.4;
                                ">
                                    <div style="color: #10b981;">[SYSTEM] Agent Communication Visualizer Started</div>
                                    <div style="color: #94a3b8;">[INFO] Monitoring A2A protocol events...</div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    document.body.appendChild(visualizer);
                    
                    // Add CSS for animations
                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes pulse {
                            0% { opacity: 1; transform: scale(1); }
                            50% { opacity: 0.5; transform: scale(1.1); }
                            100% { opacity: 1; transform: scale(1); }
                        }
                        
                        @keyframes fadeIn {
                            from { opacity: 0; }
                            to { opacity: 1; }
                        }
                        
                        .agent-card {
                            transition: all 0.3s ease;
                        }
                        
                        .agent-card:hover {
                            transform: translateY(-2px);
                            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
                        }
                        
                        .agent-card.active {
                            animation: agentActive 2s ease;
                        }
                        
                        @keyframes agentActive {
                            0% { border-color: currentColor; }
                            50% { border-color: #10b981; box-shadow: 0 0 20px rgba(16, 185, 129, 0.5); }
                            100% { border-color: currentColor; }
                        }
                    `;
                    document.head.appendChild(style);
                    
                    // Start real-time monitoring
                    startAgentMonitoring();
                }
                
                visualizer.style.display = 'flex';
            } catch (error) {
                console.error('❌ Error creating Agent Visualizer:', error);
                alert('Error opening Agent Visualizer. Please check console for details.');
            }
        }
        
        function closeAgentVisualizer() {
            const visualizer = document.getElementById('agent-visualizer');
            if (visualizer) {
                visualizer.style.display = 'none';
            }
            
            // Stop monitoring when closed
            if (window.agentMonitoringInterval) {
                clearInterval(window.agentMonitoringInterval);
            }
        }
        
        function startAgentMonitoring() {
            let syncCounter = 0;
            let lastSyncTime = Date.now();
            
            // Update sync countdown
            const updateSyncCountdown = () => {
                const timeSinceSync = Date.now() - lastSyncTime;
                const timeUntilNext = Math.max(0, 30000 - timeSinceSync);
                const secondsUntilNext = Math.ceil(timeUntilNext / 1000);
                
                const nextSyncElement = document.getElementById('next-sync-time');
                if (nextSyncElement) {
                    nextSyncElement.textContent = secondsUntilNext > 0 ? `${secondsUntilNext}s` : 'Now';
                }
            };
            
            // Simulate real-time agent activity
            const simulateAgentActivity = () => {
                // Simulate behavioral agent activity
                const clickCount = universalAI?.sessionData?.behavioral_data?.clicks?.length || Math.floor(Math.random() * 50);
                const engagementLevels = ['Basic', 'Medium', 'High', 'Expert'];
                const engagement = engagementLevels[Math.min(Math.floor(clickCount / 10), 3)];
                
                updateAgentMetric('behavioral-clicks', clickCount);
                updateAgentMetric('behavioral-engagement', engagement);
                updateAgentMetric('behavioral-interests', getRandomInterests());
                
                // Simulate motivation agent
                const energyLevels = ['Low', 'Medium', 'High'];
                const energy = energyLevels[Math.floor(Math.random() * 3)];
                updateAgentMetric('motivation-energy', energy);
                updateAgentMetric('motivation-streak', Math.floor(Math.random() * 7));
                updateAgentMetric('motivation-triggers', Math.floor(Math.random() * 5));
                
                // Simulate market intelligence
                updateAgentMetric('market-opportunities', Math.floor(Math.random() * 10));
                updateAgentMetric('market-trends', 'AI/ML, React, TypeScript');
                updateAgentMetric('market-alignment', Math.floor(Math.random() * 100) + '%');
                
                // Simulate goal setting
                updateAgentMetric('goal-active', Math.floor(Math.random() * 3));
                updateAgentMetric('goal-progress', Math.floor(Math.random() * 100) + '%');
                updateAgentMetric('goal-suggestions', Math.floor(Math.random() * 5));
            };
            
            // Log A2A communication events
            const logA2AEvent = (type, agent, message, data = null) => {
                const timestamp = new Date().toLocaleTimeString();
                const log = document.getElementById('agent-communication-log');
                
                if (log) {
                    const colors = {
                        'SYNC': '#3b82f6',
                        'INSIGHT': '#10b981',
                        'COLLABORATION': '#f59e0b',
                        'BEHAVIORAL': '#8b5cf6',
                        'GOAL': '#ec4899',
                        'MARKET': '#06b6d4'
                    };
                    
                    const color = colors[type] || '#94a3b8';
                    const dataStr = data ? ` | Data: ${JSON.stringify(data).substring(0, 50)}...` : '';
                    
                    const logEntry = document.createElement('div');
                    logEntry.style.color = color;
                    logEntry.innerHTML = `[${timestamp}] [${type}] ${agent}: ${message}${dataStr}`;
                    
                    log.appendChild(logEntry);
                    log.scrollTop = log.scrollHeight;
                    
                    // Highlight active agent
                    highlightActiveAgent(agent.toLowerCase().split(' ')[0]);
                }
            };
            
            // Simulate A2A protocol events
            const simulateA2AEvents = () => {
                const events = [
                    { type: 'BEHAVIORAL', agent: 'Behavioral Agent', message: 'Detected click on skill development content' },
                    { type: 'MARKET', agent: 'Market Agent', message: 'Correlating user interest with market trends' },
                    { type: 'COLLABORATION', agent: 'A2A Protocol', message: 'Agents sharing behavioral insights' },
                    { type: 'GOAL', agent: 'Goal Agent', message: 'Suggesting career goal based on behavior' },
                    { type: 'INSIGHT', agent: 'Multi-Agent', message: 'Generated collaborative recommendation' },
                    { type: 'SYNC', agent: 'System', message: 'A2A protocol sync completed successfully' }
                ];
                
                const randomEvent = events[Math.floor(Math.random() * events.length)];
                logA2AEvent(randomEvent.type, randomEvent.agent, randomEvent.message, { 
                    confidence: Math.floor(Math.random() * 40) + 60,
                    priority: ['low', 'medium', 'high'][Math.floor(Math.random() * 3)]
                });
            };
            
            // Start monitoring intervals
            simulateAgentActivity();
            
            // Update every 2 seconds
            window.agentMonitoringInterval = setInterval(() => {
                updateSyncCountdown();
                
                // Simulate agent activity every 3-7 seconds
                if (Math.random() < 0.4) {
                    simulateAgentActivity();
                }
                
                // Simulate A2A events every 2-5 seconds
                if (Math.random() < 0.5) {
                    simulateA2AEvents();
                }
                
                // Handle sync events every 30 seconds
                if (Date.now() - lastSyncTime >= 30000) {
                    syncCounter++;
                    lastSyncTime = Date.now();
                    
                    updateAgentMetric('total-syncs', syncCounter);
                    updateAgentMetric('last-sync-time', new Date().toLocaleTimeString());
                    
                    logA2AEvent('SYNC', 'A2A Protocol', `Sync #${syncCounter} - All agents synchronized`, {
                        agents: 4,
                        insights_shared: Math.floor(Math.random() * 10) + 1,
                        recommendations: Math.floor(Math.random() * 5) + 1
                    });
                }
            }, 2000);
        }
        
        function updateAgentMetric(elementId, value) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = value;
            }
        }
        
        function highlightActiveAgent(agentType) {
            const agentCard = document.querySelector(`[data-agent="${agentType}"]`);
            if (agentCard) {
                agentCard.classList.add('active');
                setTimeout(() => {
                    agentCard.classList.remove('active');
                }, 2000);
            }
        }
        
        function getRandomInterests() {
            const interests = ['AI/ML', 'Web Dev', 'Data Science', 'Career Growth', 'Leadership', 'Skills'];
            const count = Math.floor(Math.random() * 3) + 1;
            return interests.slice(0, count).join(', ');
        }
        
        function clearAgentLog() {
            const log = document.getElementById('agent-communication-log');
            if (log) {
                log.innerHTML = `
                    <div style="color: #10b981;">[SYSTEM] Agent Communication Log Cleared</div>
                    <div style="color: #94a3b8;">[INFO] Monitoring A2A protocol events...</div>
                `;
            }
        }
    </script>
</body>
</html>
